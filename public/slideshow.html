<!DOCTYPE html>
<html>
<head>
<title>Mémorial Slideshow</title>
<style>
body, html { margin:0; padding:0; height:100%; overflow:hidden; background:black; font-family:Arial; }
#slideshow { position:relative; width:100vw; height:100vh; }
img { position:absolute; top:0; left:0; width:100%; height:100%; object-fit:cover; opacity:0; transition:opacity 1s; }
img.active { opacity:1; }
#nom { position:fixed; bottom:20px; left:50%; transform:translateX(-50%); color:white; font-size:24px; text-shadow:2px 2px 4px black; z-index:10; }
</style>
</head>
<body>
<div id="slideshow"></div>
<div id="nom">Mémorial</div>

<script>
const slideshow = document.getElementById('slideshow');
const list_key = 'GLOBAL_MEMORIAL_IMAGES';

// Fetch JSON list
fetch(`https://blob.vercel-storage.com/${list_key}?t=${Date.now()}`)
.then(res => res.text())  // text safe
.then(raw => {
    let images = [];
    try {
        const data = JSON.parse(raw);
        images = Array.isArray(data) ? data : [];
    } catch(e) {
        console.error('JSON parse fail:', e);
    }
    
    if(images.length === 0) {
        slideshow.innerHTML = '<p style="color:white;font-size:32px;line-height:100vh;text-align:center;">Aucune photo pour le mémorial</p>';
        return;
    }
    
    // Load images
    images.forEach((url, idx) => {
        const img = document.createElement('img');
        img.src = url + '?alt=media&t=' + Date.now();  // Cache bust + media
        img.onerror = () => console.log('Image fail:', url);
        slideshow.appendChild(img);
    });
    
    let index = 0;
    function next() {
        Array.from(slideshow.children).forEach((img, i) => img.classList.toggle('active', i === index));
        index = (index + 1) % images.length;
    }
    setInterval(next, 4000);
    next();
})
.catch(e => {
    slideshow.innerHTML = '<p style="color:red;font-size:32px;line-height:100vh;text-align:center;">Erreur chargement photos</p>';
    console.error(e);
});
</script>
</body>
</html>
